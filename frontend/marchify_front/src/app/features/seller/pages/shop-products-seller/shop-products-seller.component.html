<div class="container">
  <!-- Filters Sidebar -->
  <aside class="filters">
    <div class="filters-content">
      <h2>Filtrer les produits</h2>

      <!-- Category Filter -->
      <div class="filter-group">
        <h3>Catégorie</h3>
        <label [class.active]="selectedCategory === ''">
          <input type="radio" name="category" [(ngModel)]="selectedCategory" value="" (change)="applyFilters()">
          <span>Toutes les catégories</span>
        </label>
        <label *ngFor="let cat of categories" [class.active]="selectedCategory === cat">
          <input type="radio" name="category" [(ngModel)]="selectedCategory" [value]="cat" (change)="applyFilters()">
          <span>{{ cat }}</span>
        </label>
      </div>

      <!-- Price Filter (Replaced Delivery Filter since this is Seller View) -->
      <div class="filter-group">
        <h3>Prix</h3>
        <label [class.active]="priceFilter === 'all'">
          <input type="radio" name="price" [(ngModel)]="priceFilter" value="all" (change)="applyFilters()">
          <span>Tous les prix</span>
        </label>
        <label [class.active]="priceFilter === 'low'">
          <input type="radio" name="price" [(ngModel)]="priceFilter" value="low" (change)="applyFilters()">
          <span>Moins de 10 DT</span>
        </label>
        <label [class.active]="priceFilter === 'medium'">
          <input type="radio" name="price" [(ngModel)]="priceFilter" value="medium" (change)="applyFilters()">
          <span>10 - 50 DT</span>
        </label>
        <label [class.active]="priceFilter === 'high'">
          <input type="radio" name="price" [(ngModel)]="priceFilter" value="high" (change)="applyFilters()">
          <span>Plus de 50 DT</span>
        </label>
      </div>

      <!-- Sort Filter -->
      <div class="filter-group">
        <h3>Trier par</h3>
        <label [class.active]="sortBy === 'name'">
          <input type="radio" name="sort" [(ngModel)]="sortBy" value="name" (change)="applySorting()">
          <span>Nom (A-Z)</span>
        </label>
        <label [class.active]="sortBy === 'price-asc'">
          <input type="radio" name="sort" [(ngModel)]="sortBy" value="price-asc" (change)="applySorting()">
          <span>Prix croissant</span>
        </label>
        <label [class.active]="sortBy === 'price-desc'">
          <input type="radio" name="sort" [(ngModel)]="sortBy" value="price-desc" (change)="applySorting()">
          <span>Prix décroissant</span>
        </label>
      </div>
    </div>

    <!-- Clear Filters Button - Sticky at bottom -->
    <button class="clear-filters-btn" (click)="clearFilters()">
      Réinitialiser les filtres
    </button>
  </aside>

  <!-- Products Section -->
  <main class="products-section">
    <!-- Header -->
    @if (shop && shop.nom) {
    <div class="products-header text-center">
      <h1 class="!text-4xl font-bold">Produits de {{ shop.nom }}</h1>
      <p>Gérez votre catalogue, ajoutez de nouveaux articles et mettez à jour vos stocks.</p>
      <p><strong>{{ filteredProducts.length }} produits disponibles</strong></p>
      
      <!-- Add Product Button -->
      <a
        [routerLink]="['/seller/product-add']"
        [queryParams]="{ shopId: shopId }"
        class="inline-flex items-center gap-2 mt-4 bg-[#386641] text-white px-6 py-2 rounded-lg hover:bg-[#2d5234] transition-colors no-underline font-medium">
        <i class="fa-solid fa-plus"></i>
        Ajouter un produit
      </a>
    </div>
    }

    <!-- Error Message -->
    @if (error()) {
    <div class="bg-red-50 border-l-4 border-red-500 p-4 mb-6 rounded-lg mx-auto max-w-2xl">
      <div class="flex items-center">
        <i class="fa-solid fa-exclamation-circle text-red-500 text-xl mr-3"></i>
        <div>
          <p class="text-red-800 font-semibold">Erreur</p>
          <p class="text-red-700 text-sm">{{ error() }}</p>
        </div>
      </div>
    </div>
    }

    <!-- Loading State -->
    @if (isLoading()) {
    <div class="loading">
      <div class="w-12 h-12 border-4 border-[#386641] border-t-transparent rounded-full animate-spin mx-auto mb-2"></div>
      <p>Chargement des produits...</p>
    </div>
    }

    <!-- Products Grid -->
    @else if (!isLoading() && filteredProducts.length > 0) {
    <div class="products-grid">
      @for (product of filteredProducts; track product.id) {
        <!-- Replicating ProductCard style inline -->
        <div class="bg-white rounded-lg shadow-md border border-gray-200 overflow-hidden hover:shadow-xl hover:-translate-y-1 transition-all duration-300 flex flex-col h-full group">
          
          <!-- Image Container -->
          <div class="relative pt-[45%] bg-gray-100 overflow-hidden">
            <img [src]="product.image" [alt]="product.nom" class="absolute top-0 left-0 w-full h-full object-cover transition-transform duration-500 group-hover:scale-105">
            
            <!-- Badge -->
            <div class="absolute top-2 right-2 bg-white/90 backdrop-blur-sm px-2 py-1 rounded text-xs font-semibold text-[#386641] shadow-sm">
              {{ product.categorie }}
            </div>
          </div>


          <!-- Content -->
          <div class="p-4 flex flex-col flex-1">
            <div class="flex justify-between items-start mb-2">
              <h3 class="font-bold text-gray-800 text-lg line-clamp-1 group-hover:text-[#386641] transition-colors" title="{{ product.nom }}">
                {{ product.nom }}
              </h3>
              <span class="font-bold text-[#386641] whitespace-nowrap ml-2">
                {{ product.prix }} DT
              </span>
            </div>
            
            <p class="text-gray-600 text-sm line-clamp-2 mb-4 flex-1">
              {{ product.description }}
            </p>
            <p class="text-sm font-medium mb-2 bg-green-50 p-2 rounded text-center">
              {{product.Ispinned ? 'Épinglé' : 'non Épinglé'}}
            </p>
            

            <!-- Seller Actions -->
            <div class="grid grid-cols-2 gap-2 pt-3 border-t border-gray-100 mt-auto">
              <a [routerLink]="['/edit', product.id]" class="flex items-center justify-center gap-2 bg-gray-100 hover:bg-gray-200 text-gray-700 py-2 rounded-md text-sm font-medium transition-colors no-underline">
                <i class="fa-solid fa-pen"></i> Modifier
              </a>
              <button (click)="deleteProduct(product.id)" class="flex items-center justify-center gap-2 bg-red-50 hover:bg-red-100 text-red-600 py-2 rounded-md text-sm font-medium transition-colors">
                <i class="fa-solid fa-trash"></i> Supprimer
              </button>
            </div>
          </div>
        </div>
      }
    </div>
    }

    <!-- No Results -->
    @else if (!isLoading() && filteredProducts.length === 0) {
    <div class="no-results">
      <div class="w-20 h-20 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
        <i class="fa-solid fa-box-open text-3xl text-gray-400"></i>
      </div>
      <h3 class="text-xl font-semibold text-gray-800 mb-2">Aucun produit trouvé</h3>
      <p class="text-gray-600 mb-4">Essayez d'ajuster vos filtres ou ajoutez votre premier produit.</p>
      <button (click)="clearFilters()" class="text-[#386641] font-medium hover:underline">Réinitialiser les filtres</button>
    </div>
    }
  </main>

  <!-- AI Search Button -->
  <div class="fixed bottom-6 left-6 z-50">
    <div class="absolute inset-0 rounded-full bg-[#386641] opacity-20 animate-ping"></div>
    <div class="absolute inset-0 rounded-full bg-[#F97A00] opacity-10 animate-pulse"></div>
    <a
      routerLink="/ai-search/upload-predict"
      class="relative w-12 h-12 rounded-full bg-gradient-to-br from-[#386641] to-[#6a994e] flex items-center justify-center shadow-2xl hover:scale-110 transition-all duration-300 group hover:shadow-[#F97A00]/50 no-underline"
      title="Recherche par IA">
      <div class="relative">
        <i class="fas fa-brain text-white text-2xl md:text-3xl"></i>
        <div class="absolute -bottom-1 -right-1 w-5 h-5 bg-[#F97A00] rounded-full flex items-center justify-center border-2 border-white">
          <i class="fas fa-camera text-white text-[8px]"></i>
        </div>
      </div>
    </a>
  </div>
</div>
