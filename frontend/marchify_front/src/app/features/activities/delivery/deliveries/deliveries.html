<div class="mb-6 bg-white rounded-xl shadow-sm border border-gray-300 overflow-hidden">
    <!-- Header -->
    <div class="px-5 py-4">
        <h1 class="text-lg font-bold flex items-center gap-2 text-[#386641]">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-[#386641]" fill="none" viewBox="0 0 24 24"
                stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M3 7h13v10H3V7zM16 7h5l1 5h-6V7zM16 17h5v2H16v-2zM5 17a2 2 0 100 4 2 2 0 000-4zM17 17a2 2 0 100 4 2 2 0 000-4z" />
            </svg>
            Bons De livraisons
        </h1>
    </div>


    @if (deliveries.length === 0) {
    <div class="py-12 text-center bg-gray-50">
        <div class="inline-flex items-center justify-center w-14 h-14 rounded-full bg-[#386641]/10 text-[#386641] mb-4">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24"
                stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H4" />
            </svg>
        </div>
        <p class="text-gray-500 font-medium">Vous n'avez pas encore passer de bon de livraison.</p>
    </div>
    } @else {
    <div class="flex flex-col">
        <div class="overflow-x-auto sm:-mx-6 lg:-mx-8">
            <div class="py-2 align-middle inline-block min-w-full sm:px-6 lg:px-8">
                <div class="shadow overflow-hidden border-b border-gray-200 sm:rounded-lg">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th scope="col"
                                    class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    Numéro
                                </th>
                                <th scope="col"
                                    class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    Client
                                </th>
                                <th scope="col"
                                    class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    Boutique
                                </th>
                                <th scope="col"
                                    class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    Date
                                </th>
                                <th scope="col"
                                    class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    Status
                                </th>
                                <th scope="col"
                                    class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    Action
                                </th>

                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200">
                            @for (livraison of deliveries; track livraison.id) {
                            <tr>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="text-sm text-gray-900">
                                        {{ livraison.commandeId }}
                                    </div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="text-sm text-gray-900">
                                        {{ livraison.commande.client.nom }} {{ livraison.commande.client.prenom }}
                                    </div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="text-sm text-gray-900">
                                        {{ livraison.commande.boutique.nom }}
                                    </div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="text-sm text-gray-900">
                                        {{ livraison.dateCreation| date:'dd/MM/yyyy' }}
                                    </div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full"
                                        [ngClass]="{
      'bg-orange-100 text-orange-800': livraison.status === 'PENDING_PICKUP',
      'bg-blue-100 text-blue-800': livraison.status === 'IN_TRANSIT',
      'bg-green-100 text-green-800': livraison.status === 'DELIVERED',
      'bg-red-100 text-red-800': livraison.status === 'FAILED'
    }">
                                        {{
                                        livraison.status === 'PENDING_PICKUP' ? 'En attente' :
                                        livraison.status === 'IN_TRANSIT' ? 'En cours' :
                                        livraison.status === 'DELIVERED' ? 'Livré' :
                                        livraison.status === 'FAILED' ? 'Échoué' : livraison.status
                                        }}
                                    </span>
                                </td>

                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                    <button (click)="openModal(livraison)"
                                        class="relative inline-block px-4 py-1 font-semibold text-white rounded-lg
                 bg-gradient-to-r from-orange-400 to-orange-600
                 shadow-md hover:shadow-xl
                 transition-all duration-300
                 transform hover:-translate-y-0.5 hover:scale-99
                 overflow-hidden
                 after:absolute after:inset-0 after:bg-white after:opacity-10 after:rounded-lg after:translate-x-[-100%] after:transition-transform after:duration-500 hover:after:translate-x-[100%]">
                                        Voir détails
                                    </button>
                                </td>


                            </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    }
</div>


@if (showModal && selectedLivraison) {
<div class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 backdrop-blur-sm">
    <div class="bg-white w-full max-w-4xl rounded-3xl shadow-2xl p-8 relative animate-fadeIn">

        <!-- Close button -->
        <button (click)="closeModal()"
            class="absolute right-5 top-5 text-gray-400 hover:text-gray-700 transition-transform hover:scale-110">
            ✕
        </button>

        <!-- Title -->
        <h2 class="text-3xl font-extrabold text-gray-900 mb-6">
            Bon de Livraison – <span class="text-[#386641]">#{{ selectedLivraison.id }}</span>
        </h2>

        <!-- Infos générales -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">

            <!-- Expéditeur -->
            <div class="bg-green-50 p-5 rounded-2xl shadow-inner border border-green-100">
                <h3 class="font-bold text-[#386641] mb-3 text-lg">Expéditeur (Boutique)</h3>
                <p><b>Nom :</b> {{ selectedLivraison.commande.boutique.nom }}</p>
                <p><b>Téléphone :</b> {{ selectedLivraison.commande.boutique.telephone }}</p>
                <p><b>Adresse :</b> {{ selectedLivraison.commande.boutique.adresse }}</p>
            </div>

            <!-- Destinataire -->
            <div class="bg-blue-50 p-5 rounded-2xl shadow-inner border border-blue-100">
                <h3 class="font-bold text-[#386641] mb-3 text-lg">Destinataire (Client)</h3>
                <p><b>Nom :</b> {{ selectedLivraison.commande.client.nom }} {{ selectedLivraison.commande.client.prenom
                    }}</p>
                <p><b>Téléphone :</b> {{ selectedLivraison.commande.client.telephone }}</p>
                <p><b>Adresse :</b>{{ selectedLivraison.commande.adresseLivraison.rue }},{{
                    selectedLivraison.commande.adresseLivraison.ville }}</p>
            </div>

        </div>

        <!-- Date -->
        <p class="text-gray-600 mb-6 text-md">
            <b>Date :</b> {{ selectedLivraison.dateCreation | date:'dd/MM/yyyy HH:mm' }}
        </p>

        <!-- Tableau Produits -->
        <div class="overflow-x-auto rounded-xl border border-gray-200 shadow-sm">
            <table class="w-full text-left text-gray-700">
                <thead class="bg-gray-100">
                    <tr>
                        <th class="p-3 text-sm font-semibold">N°</th>
                        <th class="p-3 text-sm font-semibold">Produit</th>
                        <th class="p-3 text-sm font-semibold">Quantité</th>
                        <th class="p-3 text-sm font-semibold">Prix</th>
                        <th class="p-3 text-sm font-semibold">Total</th>
                    </tr>
                </thead>
                <tbody>
                    @for (item of selectedLivraison.commande.produits; track item.produit.nom) {
                    <tr class="border-t hover:bg-gray-50 transition">
                        <td class="p-3 font-medium">{{ 1 }}</td>
                        <td class="p-3">{{ item.produit.nom }}</td>
                        <td class="p-3">{{ item.quantite }}</td>
                        <td class="p-3">{{ item.produit.prix }} DT</td>
                        <td class="p-3 font-semibold text-gray-900">{{ item.prixTotal }} DT</td>
                    </tr>
                    }
                </tbody>
            </table>
        </div>

        <!-- Total final -->
        <div class="flex justify-end mt-6 text-xl font-bold text-gray-900">
            <span>Total : </span>
            <span class="ml-2 text-orange-500">{{ selectedLivraison.commande.totalCommande | price }}</span>
        </div>

    </div>
</div>
}