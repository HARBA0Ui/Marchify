<div class="container mx-auto p-6">

    <!-- SECTION PRODUIT -->
    <div class="flex flex-col md:flex-row bg-white shadow-md rounded-xl p-6 gap-6">

        <!-- IMAGE -->
        <div class="w-full md:w-1/2 flex justify-center">
            <img [src]="produit.image" class="rounded-lg max-h-80 object-cover shadow-md" alt="{{ produit.nom }}">
        </div>

        <!-- INFO PRODUIT -->
        <div class="w-full md:w-1/2 flex flex-col justify-between">
            <div>
                <h1 class="text-3xl font-bold mb-3">{{ produit.nom }}</h1>

                <p class="text-gray-700 mb-4">{{ produit.description }}</p>

                <p class="text-xl font-semibold text-green-600 mb-4">
                    Prix : {{ produit.prix | currency:'USD' }}
                </p>

                <!-- RATING GLOBAL -->
                <div class="flex items-center mb-4">
                    <ng-container *ngFor="let star of [1,2,3,4,5]">
                        <span class="text-yellow-400 text-3xl mr-1">
                            {{ star <= getAverageRating() ? '★' : '☆' }} </span>
                    </ng-container>
                    <span class="ml-2 text-gray-600 text-sm">
                        ({{ getAverageRating() }} / 5)
                    </span>
                </div>
            </div>
        </div>

    </div>

    <hr class="my-8">

    <!-- SECTION AVIS -->
    <h2 class="text-2xl font-bold mb-4">Avis des clients</h2>

    <div *ngIf="reviews.length === 0" class="text-gray-500 mb-6">
        Aucun avis pour le moment.
    </div>

    <div *ngFor="let review of reviews" class="border p-4 rounded-lg mb-4 shadow-sm bg-gray-50">

        <p class="font-semibold mb-1">
            {{ review.auteur?.nom }} {{ review.auteur?.prenom }}
        </p>

        <!-- ÉTOILES -->
        <div class="flex mb-2">
            <ng-container *ngFor="let star of [1,2,3,4,5]">
                <span class="text-yellow-400 text-xl mr-1">
                    {{ star <= review.rating ? '★' : '☆' }} </span>
            </ng-container>
        </div>

        <p class="text-gray-700">{{ review.comment }}</p>
    </div>

    <hr class="my-8">

    <!-- AJOUTER AVIS -->
    <h3 class="text-xl font-bold mb-3">Ajouter un avis</h3>

    <!-- ÉTOILES CLICKABLE -->
    <div class="flex mb-2">
        <ng-container *ngFor="let star of [1,2,3,4,5]">
            <span class="text-3xl mr-1 cursor-pointer" [class.text-yellow-400]="star <= newRating"
                [class.text-gray-400]="star > newRating" (click)="setRating(star)">
                ★
            </span>
        </ng-container>
    </div>

    <textarea [(ngModel)]="newComment" rows="4" placeholder="Votre commentaire..."
        class="w-full p-3 border rounded-lg mb-3"></textarea>

    <div *ngIf="newComment.trim().length > 0 && newComment.trim().length < 6" class="text-red-500 text-sm mb-3">
        Le commentaire doit contenir au moins 6 caractères.
    </div>

    <button (click)="submitReview()" [disabled]="!isCommentValid() || !newRating || !token"
        class="bg-blue-600 text-white px-5 py-2 rounded-lg shadow disabled:opacity-40">
        Envoyer
    </button>

    <button *ngIf="!token" class="bg-gray-300 px-4 py-2 rounded-lg ml-3" (click)="router.navigate(['/login'])">
        Se connecter
    </button>

</div>