<!-- Products Section Title -->
<div class="mb-6">
  <h2 class="text-2xl font-extrabold text-[#212c57] mb-2">
    📦 Produits Disponibles
  </h2>
  <p class="text-gray-600">
    {{ filteredProducts.length }} produit{{ filteredProducts.length !== 1 ? 's' : '' }} 
    @if (searchQuery || deliveryFilter !== 'all') {
      <span class="text-[#fcb046] font-semibold">(filtrés)</span>
    }
  </p>
</div>

<!-- Filters Section -->
<div class="mb-8 bg-white rounded-2xl shadow-md p-6">
  <div class="flex flex-wrap gap-4">
    
    <!-- Search Bar -->
    <div class="flex-1 min-w-[200px]">
      <input
        type="text"
        [(ngModel)]="searchQuery"
        (input)="applyFilters()"
        placeholder="🔍 Rechercher un produit..."
        class="w-full border-2 border-gray-300 rounded-lg px-4 py-2 text-sm focus:ring-2 focus:ring-[#fcb046] focus:border-[#fcb046] outline-none transition-all"
      />
    </div>

    <!-- Delivery Filter -->
    <select 
      [(ngModel)]="deliveryFilter" 
      (change)="applyFilters()"
      class="border-2 border-gray-300 rounded-lg px-4 py-2 text-sm focus:ring-2 focus:ring-[#fcb046] focus:border-[#fcb046] outline-none"
    >
      <option value="all">📦 Tous les produits</option>
      <option value="livrable">🚚 Livrables uniquement</option>
      <option value="non-livrable">🏪 Retrait uniquement</option>
    </select>

    <!-- Sort -->
    <select 
      [(ngModel)]="sortBy" 
      (change)="applySorting()"
      class="border-2 border-gray-300 rounded-lg px-4 py-2 text-sm focus:ring-2 focus:ring-[#fcb046] focus:border-[#fcb046] outline-none"
    >
      <option value="name">📝 Nom (A-Z)</option>
      <option value="price-asc">💰 Prix croissant</option>
      <option value="price-desc">💰 Prix décroissant</option>
      <option value="stock">📊 Stock disponible</option>
    </select>

    <!-- Reset Button -->
    <button 
      (click)="clearFilters()" 
      class="bg-[#fcb046] text-white rounded-lg px-6 py-2 text-sm font-semibold hover:bg-[#fda428] transition-all shadow-md hover:shadow-lg"
    >
      🔄 Réinitialiser
    </button>

  </div>
</div>

<!-- Products Grid -->
@if (isLoading) {
  <div class="text-center py-20">
    <div class="inline-block w-16 h-16 border-4 border-[#fcb046] border-t-[#212c57] rounded-full animate-spin"></div>
    <p class="mt-4 text-gray-500 font-semibold">Chargement des produits...</p>
  </div>
} @else if (filteredProducts.length === 0) {
  <div class="text-center py-20 bg-gray-50 rounded-2xl">
    <div class="text-6xl mb-4">📭</div>
    <h3 class="text-xl font-bold text-gray-700 mb-2">Aucun produit trouvé</h3>
    <p class="text-gray-500">
      @if (searchQuery || deliveryFilter !== 'all') {
        Essayez de modifier vos filtres de recherche
      } @else {
        Cette boutique n'a pas encore de produits
      }
    </p>
    @if (searchQuery || deliveryFilter !== 'all') {
      <button 
        (click)="clearFilters()" 
        class="mt-4 bg-[#fcb046] text-white px-6 py-2 rounded-lg font-semibold hover:bg-[#fda428] transition-all"
      >
        Réinitialiser les filtres
      </button>
    }
  </div>
} @else {
  <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
    @for (product of filteredProducts; track product.id) {
      <app-product-card
        [product]="product"
        (addToCartEvent)="onAddToCart($event)"
        (viewDetailsEvent)="onViewDetails($event)"
      ></app-product-card>
    }
  </div>
}